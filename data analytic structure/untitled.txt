–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≥–æ–¥ –≤ –∫–æ–º–ø–∞–Ω–∏–∏, –∑–∞–Ω–∏–º–∞—é—â–µ–π—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è. –û–Ω–∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É —Å –¥–∞–Ω–Ω—ã–º–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

---

### **1-3 –º–µ—Å—è—Ü** (–í—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç, –∏–∑—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–≤—ã–µ –∑–∞–¥–∞—á–∏)
‚úÖ –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL, –∏–∑—É—á–∏—Ç—å —Å—Ö–µ–º—É –ë–î, –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞–±–æ—Ç–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.  
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DAG –≤ Apache Airflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤.  
‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞–±–æ—Ç–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.  
‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç–¥–µ–ª–æ–≤.  
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Git –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è SQL-—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ Python-–∫–æ–¥–∞.  

---

### **4-6 –º–µ—Å—è—Ü** (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏)
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∞–≤–∞—Ä–∏–π–Ω—ã–º —Å–æ–±—ã—Ç–∏—è–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Å —Ä–∞—Å—á–µ—Ç–æ–º —Å—Ä–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –æ—Ç–∫–∞–∑–æ–≤.  
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DAG –≤ Airflow –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ –æ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.  
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –∏ Python-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–µ–ø–µ–Ω–∏ –∏–∑–Ω–æ—Å–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç—ã.  
‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –æ—Ç–∫–∞–∑–∞–º –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–º –ø–æ–ª–æ–º–∫–∞–º –≤ –≤–∏–¥–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ (Tableau / Python / Grafana).  
‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–ª–µ—Ä—Ç–æ–≤: –µ—Å–ª–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º—É —É—Ä–æ–≤–Ω—é –∏–∑–Ω–æ—Å–∞ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram/Slack.  

---

### **7-9 –º–µ—Å—è—Ü** (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–∞–∑–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Python, ML-–º–æ–¥–µ–ª—å –∏–ª–∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã).  
‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –∏ DAG –≤ Airflow –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.  
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏ –≤–Ω–µ–¥—Ä–∏—Ç—å –Ω–æ–≤—É—é –≤–∏—Ç—Ä–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞–±–æ—Ç–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞.  
‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏ –µ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.  
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–Ω–æ–º–∞–ª–∏–π –≤ –¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Ä–µ–∑–∫–æ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –æ—Ç –Ω–æ—Ä–º—ã, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.  

---

### **10-12 –º–µ—Å—è—Ü** (–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã)
‚úÖ –£–ª—É—á—à–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞—Å—á–µ—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–≤–∫–ª—é—á–∞—è —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è –∏ –¥—Ä.).  
‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL, –≤—ã—è–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏ –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è.  
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ–≤—ã–µ KPI –∏ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ).  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º—É, –∏—Å–ø–æ–ª—å–∑—É—è API –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.  
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –¥–∞—à–±–æ—Ä–¥–æ–≤: –∫–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∞–∂–Ω—ã, —á—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å.  

---

–í–æ—Ç –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ DAG –≤ Apache Airflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤ –∏ –∑–∞–ø–∏—Å–∏ –∏—Ö –≤ PostgreSQL.  

---

## **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Apache Airflow (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)**
–ï—Å–ª–∏ Airflow –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ä–∞–∑–≤–µ—Ä–Ω—ë–º –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `pip`:
```bash
pip install apache-airflow
```
–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Airflow:
```bash
psql -U postgres -h localhost

–ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –±–∞–∑—É –¥–ª—è Airflow:

CREATE DATABASE airflow_db;
CREATE USER airflow_user WITH ENCRYPTED PASSWORD 'strongpassword';
GRANT ALL PRIVILEGES ON DATABASE airflow_db TO airflow_user;

```
–ù–∞—Å—Ç—Ä–æ–π Airflow –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PostgreSQL

–û—Ç–∫—Ä–æ–π airflow.cfg (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ ~/airflow/airflow.cfg) –∏ –Ω–∞–π–¥–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä:

sql_alchemy_conn = sqlite:////path/to/airflow.db
–ó–∞–º–µ–Ω–∏ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL:

sql_alchemy_conn = postgresql+psycopg2://airflow_user:strongpassword@localhost/airflow_db

```
–ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
airflow db init
–¢–µ–ø–µ—Ä—å Airflow –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL –≤–º–µ—Å—Ç–æ SQLite

–°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
```bash
airflow users create \
    --username admin \
    --password admin \
    --firstname John \
    --lastname Doe \
    --role Admin \
    --email admin@example.com
```
–ó–∞–ø—É—Å–∫–∞–µ–º Airflow Scheduler –∏ Web Server:
```bash
airflow scheduler &
airflow webserver -p 9090 &
```
–¢–µ–ø–µ—Ä—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8080](http://localhost:9090)

---

## **2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL**
Airflow –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Connections** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ë–î. –ù–∞—Å—Ç—Ä–æ–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ UI:
1. –û—Ç–∫—Ä—ã–≤–∞–µ–º [http://localhost:8080](http://localhost:8080).
2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ **Admin ‚Üí Connections**.
3. –ù–∞–∂–∏–º–∞–µ–º **+ Add Connection**.
4. –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ:
   - **Connection Id**: `postgres_default`
   - **Conn Type**: `Postgres`
   - **Host**: `your_postgres_host`
   - **Schema**: `your_database`
   - **Login**: `your_username`
   - **Password**: `your_password`
   - **Port**: `5432`
5. –°–æ—Ö—Ä–∞–Ω—è–µ–º.

---

## **3. –°–æ–∑–¥–∞–Ω–∏–µ DAG –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤**
–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º **DAG**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:
- –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ API.
- –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –∏—Ö –≤ PostgreSQL.

### **3.1 –°–æ–∑–¥–∞—ë–º DAG**
–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª **`sensor_data_dag.py`** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `dags/`:
```python
from airflow import DAG
from airflow.providers.postgres.operators.postgres import PostgresOperator
from airflow.operators.python import PythonOperator
from datetime import datetime, timedelta
import requests
import json

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã DAG
default_args = {
    "owner": "airflow",
    "depends_on_past": False,
    "start_date": datetime(2024, 3, 31),
    "retries": 1,
    "retry_delay": timedelta(minutes=5),
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ API
def fetch_sensor_data():
    url = "https://api.example.com/sensor-data"  # URL API –¥–∞—Ç—á–∏–∫–æ–≤
    response = requests.get(url)
    if response.status_code == 200:
        data = response.json()
        return data
    else:
        raise Exception(f"–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ API: {response.status_code}")

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
def insert_sensor_data(**kwargs):
    from airflow.providers.postgres.hooks.postgres import PostgresHook
    
    pg_hook = PostgresHook(postgres_conn_id="postgres_default")
    data = kwargs['ti'].xcom_pull(task_ids='fetch_data')

    if not data:
        raise ValueError("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø–∏—Å–∏")

    insert_query = """
        INSERT INTO sensor_data (sensor_id, value, timestamp)
        VALUES (%s, %s, %s);
    """

    with pg_hook.get_conn() as conn:
        with conn.cursor() as cursor:
            for entry in data:
                cursor.execute(insert_query, (entry["sensor_id"], entry["value"], entry["timestamp"]))
        conn.commit()

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º DAG
with DAG(
    "sensor_data_dag",
    default_args=default_args,
    description="–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤ –∏ –∑–∞–ø–∏—Å—å –≤ PostgreSQL",
    schedule_interval=timedelta(minutes=30),  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
    catchup=False,
) as dag:

    # –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å API
    fetch_data = PythonOperator(
        task_id="fetch_data",
        python_callable=fetch_sensor_data,
    )

    # –®–∞–≥ 2: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ PostgreSQL
    insert_data = PythonOperator(
        task_id="insert_data",
        python_callable=insert_sensor_data,
        provide_context=True,
    )

    # –£–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    fetch_data >> insert_data
```

---

## **4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)**
–í—ã–ø–æ–ª–Ω–∏–º SQL-–∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã:
```sql
CREATE TABLE sensor_data (
    id SERIAL PRIMARY KEY,
    sensor_id VARCHAR(50),
    value FLOAT,
    timestamp TIMESTAMP
);
```

---

## **5. –ó–∞–ø—É—Å–∫ DAG**
–¢–µ–ø–µ—Ä—å –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω–∞—à DAG:
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º Airflow Scheduler:
   ```bash
   airflow scheduler
   ```
2. –û—Ç–∫—Ä—ã–≤–∞–µ–º [http://localhost:8080](http://localhost:8080).
3. –ó–∞—Ö–æ–¥–∏–º –≤ **DAGs** ‚Üí **sensor_data_dag**.
4. –ù–∞–∂–∏–º–∞–µ–º **Trigger DAG** –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

---

## **6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è DAG –ø—Ä–æ–≤–µ—Ä–∏–º –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL:
```sql
SELECT * FROM sensor_data ORDER BY timestamp DESC LIMIT 10;
```

---

## **7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
1. **–î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è**: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EmailOperator –∏–ª–∏ Telegram API.
2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.
3. **–û–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π**: –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å–∏.

---

### **–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å Airflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ PostgreSQL üöÄ**



–ü–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ–ø–∏—à–µ–º —Å 6 —à–∞–≥–∞

### **üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DAG –≤ Apache Airflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤**  
üí° **–¶–µ–ª—å**:  
- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ MQTT-—Ç–æ–ø–∏–∫ (–≥–¥–µ Wiren Board –ø—É–±–ª–∏–∫—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤).  
- –ü–æ–ª—É—á–∏—Ç—å JSON-–¥–∞–Ω–Ω—ã–µ.  
- –ó–∞–ø–∏—Å–∞—Ç—å –∏—Ö –≤ PostgreSQL.  
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DAG –≤ Airflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.  

---

## **üîπ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
–ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π DAG –≤ Airflow, —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç.

### **üõ† –¢—Ä–µ–±—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
‚úÖ **Apache Airflow** ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ (ETL, —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö).  
‚úÖ **PostgreSQL** ‚Äì –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤.  
‚úÖ **Mosquitto MQTT** ‚Äì –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç Wiren Board).  
‚úÖ **Paho-MQTT (Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)** ‚Äì –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ MQTT-—Ç–æ–ø–∏–∫.  
‚úÖ **psycopg2 (Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)** ‚Äì –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL.  

### **üìå –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```bash
pip install apache-airflow psycopg2 paho-mqtt
```

---

## **üîπ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤**
–°–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É `sensor_data` –≤ PostgreSQL:  
```sql
CREATE TABLE sensor_data (
    id SERIAL PRIMARY KEY,
    sensor_id TEXT NOT NULL,
    value NUMERIC NOT NULL,
    unit TEXT NOT NULL,
    timestamp TIMESTAMP NOT NULL
);
```
üíæ **–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–æ–ª—É—á–∏–º –æ—Ç MQTT.**

---

## **üîπ 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Airflow –∫ PostgreSQL**
Airflow –¥–æ–ª–∂–µ–Ω "–∑–Ω–∞—Ç—å", –∫—É–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.  
–ù–∞—Å—Ç—Ä–æ–∏–º **Connection** –≤ Airflow UI:

1. –û—Ç–∫—Ä—ã–≤–∞–µ–º **Airflow Web UI**  
   ```bash
   airflow webserver -p 8080
   ```
2. –ó–∞—Ö–æ–¥–∏–º –≤ **Admin ‚Üí Connections**.  
3. –ù–∞–∂–∏–º–∞–µ–º **+ Add Connection**.  
4. –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è:  
   - **Conn Id**: `postgres_sensor_db`  
   - **Conn Type**: `Postgres`  
   - **Host**: `localhost`  
   - **Schema**: `sensors`  
   - **Login**: `admin`  
   - **Password**: `secret`  
   - **Port**: `5432`  
5. **–°–æ—Ö—Ä–∞–Ω—è–µ–º**.

–¢–µ–ø–µ—Ä—å Airflow —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å PostgreSQL. ‚úÖ  

---

## **üîπ 4. –°–æ–∑–¥–∞–Ω–∏–µ Python-—Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å MQTT**
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ MQTT, –ø–æ–ª—É—á–∞—Ç—å JSON-–¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∏—Ö –≤ PostgreSQL.

üìå **–°–æ–∑–¥–∞–¥–∏–º `mqtt_to_postgres.py` –≤ –ø–∞–ø–∫–µ DAGs**  
üìÇ **–ü—É—Ç—å**: `~/airflow/dags/mqtt_to_postgres.py`

```python
from airflow import DAG
from airflow.operators.python import PythonOperator
from airflow.providers.postgres.hooks.postgres import PostgresHook
import paho.mqtt.client as mqtt
import json
from datetime import datetime, timedelta

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã DAG
default_args = {
    "owner": "airflow",
    "depends_on_past": False,
    "start_date": datetime(2024, 3, 31),
    "retries": 1,
    "retry_delay": timedelta(minutes=5),
}

dag = DAG(
    "mqtt_to_postgres",
    default_args=default_args,
    schedule_interval="*/5 * * * *",  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    catchup=False,
)

# –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
def on_message(client, userdata, message):
    data = json.loads(message.payload.decode("utf-8"))
    pg_hook = PostgresHook(postgres_conn_id="postgres_sensor_db")
    conn = pg_hook.get_conn()
    cursor = conn.cursor()
    
    insert_query = """
        INSERT INTO sensor_data (sensor_id, value, unit, timestamp)
        VALUES (%s, %s, %s, %s)
    """
    cursor.execute(insert_query, (data["sensor_id"], data["value"], data["unit"], data["timestamp"]))
    conn.commit()

# –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ MQTT-–∫–ª–∏–µ–Ω—Ç–∞
def run_mqtt():
    client = mqtt.Client()
    client.connect("mqtt_broker_address")  # –£–∫–∞–∂–∏ –∞–¥—Ä–µ—Å –±—Ä–æ–∫–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, localhost)
    client.subscribe("sensors/temperature")
    client.on_message = on_message
    client.loop_start()

# Airflow –∑–∞–¥–∞—á–∞
mqtt_task = PythonOperator(
    task_id="mqtt_listener",
    python_callable=run_mqtt,
    dag=dag,
)

mqtt_task
```
---

## **üîπ 5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ DAG –≤ Airflow**
1Ô∏è‚É£ **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `mqtt_to_postgres.py` –≤ –ø–∞–ø–∫—É DAGs Airflow**  
```bash
mv mqtt_to_postgres.py ~/airflow/dags/
```
2Ô∏è‚É£ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Airflow Scheduler**  
```bash
airflow scheduler &
```
3Ô∏è‚É£ **–ó–∞–π—Ç–∏ –≤ Airflow UI –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å DAG**  
- –û—Ç–∫—Ä—ã—Ç—å `http://localhost:8080`
- –ù–∞–π—Ç–∏ **mqtt_to_postgres**
- –í–∫–ª—é—á–∏—Ç—å (—Ç—É–º–±–ª–µ—Ä –≤ `ON`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ **Graph View**

---

## **üîπ 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**
1Ô∏è‚É£ **–ü–æ—Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ DAG**  
```bash
airflow tasks test mqtt_to_postgres mqtt_listener 2024-03-31
```
‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤—ã–≤–æ–¥, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MQTT –∏ –≤—Å—Ç–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL.

2Ô∏è‚É£ **–ü—Ä–æ–≤–µ—Ä–∏–º PostgreSQL**  
```bash
psql -U admin -d sensors -h localhost -W
```
```sql
SELECT * FROM sensor_data ORDER BY timestamp DESC LIMIT 10;
```
‚úÖ –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç –¥–∞—Ç—á–∏–∫–æ–≤.

---

## **üîπ 7. –î–∞–ª—å–Ω–µ–π—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ PostgreSQL, –º–æ–∂–Ω–æ:
- üìä **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —Å –ø–æ–º–æ—â—å—é Python (Pandas, SQLAlchemy)**
- üìâ **–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤ Grafana –∏–ª–∏ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö**
- üì¢ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã (–µ—Å–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã—à–µ 70¬∞C ‚Üí –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ)**

---

### **üéØ –ò—Ç–æ–≥**
üìå **–ú—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ Airflow DAG**, –∫–æ—Ç–æ—Ä—ã–π:
1. **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç**.
2. **–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ MQTT-—Ç–æ–ø–∏–∫ `sensors/temperature`**.
3. **–ü—Ä–∏–Ω–∏–º–∞–µ—Ç JSON-–¥–∞–Ω–Ω—ã–µ –æ—Ç Wiren Board**.
4. **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL**.
5. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤**.

–¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –≤ –ë–î! üöÄ
